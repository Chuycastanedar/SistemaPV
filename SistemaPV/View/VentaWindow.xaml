<Window x:Class="SistemaPV.View.VentaWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        mc:Ignorable="d"
        WindowState="Maximized"
        WindowStartupLocation="CenterScreen"
        Title="Venta" >

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding WindowLoadedCommand}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="250"/>
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0" Background="#FFEAEAEA" Margin="5">
            <Label Content="SISTEMA : PUNTO DE VENTA" FontWeight="Bold" Margin="5"/>
            <Label Content="Usuario : Cajero" FontWeight="Bold" Margin="5,0,5,0"/>

            <RadioButton Content="Hacer Venta" IsChecked="True" GroupName="Navegacion" Margin="10,5"
                         Command="{Binding ShowVentaViewCommand}"/>
            <RadioButton Content="Historial de ventas" GroupName="Navegacion" Margin="10,5"
                         Command="{Binding ShowHistorialViewCommand}"/>
            <RadioButton Content="Inventario" GroupName="Navegacion" Margin="10,5"
                         Command="{Binding ShowInventarioViewCommand}"/>

            <Button Content="Cerrar sesión" VerticalAlignment="Bottom" Margin="10" Padding="5"
                    Command="{Binding CerrarSesionCommand}"/>
        </StackPanel>

        <Grid Grid.Column="1" Margin="5">
            <StackPanel Visibility="{Binding PanelVentaVisibility}">
                <StackPanel Orientation="Horizontal" Margin="5">
                    <Label Content="Productos disponibles:" FontWeight="Bold" VerticalAlignment="Center"/>
                    <ComboBox Width="250" Margin="10,0" IsEditable="True"
                              ItemsSource="{Binding ProductosFiltradosCombo}"
                              SelectedItem="{Binding SelectedProductoCombo}"
                              Text="{Binding TextoBusquedaProducto, UpdateSourceTrigger=PropertyChanged}"
                              DisplayMemberPath="NOMBRE_PRODUCTO"
                              SelectedValuePath="ID_PRODUCTO"/>

                    <Label Content="Cantidad:" VerticalAlignment="Center"/>

                    <StackPanel Orientation="Horizontal" Margin="10,0" VerticalAlignment="Center">
                        <Button Content="-" Width="25" FontWeight="Bold"
                                Command="{Binding DecrementarCantidadCommand}"/>
                        <TextBox Width="40" TextAlignment="Center"
                                 Text="{Binding CantidadVenta, UpdateSourceTrigger=PropertyChanged}"
                                 PreviewTextInput="TxtCantidad_PreviewTextInput"/>
                        <Button Content="+" Width="25" FontWeight="Bold"
                                Command="{Binding IncrementarCantidadCommand}"/>
                    </StackPanel>

                    <Button Content="Agregar" Padding="5,2" Margin="10,0"
                            Command="{Binding AgregarAlCarritoCommand}"/>
                </StackPanel>

                <DataGrid Margin="5" Height="350"
                          ItemsSource="{Binding Carrito}"
                          SelectedItem="{Binding SelectedCarritoItem}"
                          AutoGenerateColumns="False" IsReadOnly="True"
                          SelectionMode="Single">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="No." Binding="{Binding Numero}" Width="50"/>
                        <DataGridTextColumn Header="Producto" Binding="{Binding Nombre}" Width="*"/>
                        <DataGridTextColumn Header="Cantidad" Binding="{Binding Cantidad}" Width="100"/>
                        <DataGridTextColumn Header="Precio $" Binding="{Binding Precio, StringFormat=F2}" Width="100"/>
                        <DataGridTextColumn Header="Monto Parcial $" Binding="{Binding Subtotal, StringFormat=F2}" Width="150"/>
                    </DataGrid.Columns>
                </DataGrid>

                <Button Content="Quitar Producto Seleccionado" 
                        Width="180" Height="30" Margin="5" HorizontalAlignment="Right"
                        Command="{Binding QuitarDelCarritoCommand}"/>
            </StackPanel>

            <StackPanel Visibility="{Binding PanelHistorialVisibility}">
                <DataGrid Margin="5" Height="350"
                          ItemsSource="{Binding HistorialVentas}"
                          SelectedItem="{Binding SelectedHistorialItem}"
                          AutoGenerateColumns="False" IsReadOnly="True"
                          CanUserAddRows="False"
                          HorizontalScrollBarVisibility="Disabled"
                          SelectionMode="Single">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID VENTA" Binding="{Binding ID_VENTA}" Width="80"/>
                        <DataGridTextColumn Header="FECHA" Binding="{Binding FECHA_VENTA, StringFormat=dd/MM/yyyy HH:mm}" Width="120"/>
                        <DataGridTextColumn Header="CAJERO" Binding="{Binding CAJERO}" Width="150"/>
                        <DataGridTextColumn Header="PRODUCTOS" Binding="{Binding CANTIDAD_PRODUCTOS}" Width="80"/>
                        <DataGridTextColumn Header="MÉTODO DE PAGO" Binding="{Binding METODO_PAGO}" Width="120"/>
                        <DataGridTextColumn Header="TOTAL $" Binding="{Binding MONTO_TOTAL, StringFormat=F2}" Width="100"/>
                        <DataGridTextColumn Header="ESTADO VENTA" Binding="{Binding ESTADO_VENTA}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>

                <StackPanel Margin="5" Background="#FFF0F0F0" Visibility="{Binding PanelDetallesVentaVisibility}">
                    <Label Content="Productos de la Venta:" FontWeight="Bold" Margin="0,5,0,5"/>
                    <DataGrid Height="150"
                              ItemsSource="{Binding DetallesVenta}"
                              AutoGenerateColumns="False" IsReadOnly="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Producto" Binding="{Binding NOMBRE_PRODUCTO}" Width="*"/>
                            <DataGridTextColumn Header="Cantidad" Binding="{Binding CANTIDAD}" Width="80"/>
                            <DataGridTextColumn Header="Precio Unitario al vender $" Binding="{Binding PRECIO_UNITARIO, StringFormat=F2}" Width="120"/>
                            <DataGridTextColumn Header="Subtotal $" Binding="{Binding SUBTOTAL, StringFormat=F2}" Width="120"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="5">
                    <Button Content="Cancelar Venta" 
                            Width="120" Height="30" Margin="5"
                            Command="{Binding CancelarVentaHistorialCommand}"/>
                    <Button Content="Ver Detalles" 
                            Width="100" Height="30" Margin="5"
                            Command="{Binding VerDetallesVentaCommand}"/>
                </StackPanel>
            </StackPanel>

            <StackPanel Visibility="{Binding PanelInventarioVisibility}">
                <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top">
                    <Label Content="Buscar producto:" FontWeight="Bold" VerticalAlignment="Center"/>
                    <TextBox Width="300" Margin="10,0" VerticalAlignment="Center"
                             Text="{Binding TextoBusquedaInventario, UpdateSourceTrigger=PropertyChanged}"/>
                    <Button Content="Limpiar" Width="80" Margin="10,0" Padding="5,2" VerticalAlignment="Center"
                            Command="{Binding LimpiarBusquedaInventarioCommand}"/>
                </StackPanel>
                <DataGrid Margin="5" 
                          ItemsSource="{Binding InventarioFiltrado}"
                          AutoGenerateColumns="False" IsReadOnly="True"
                          VerticalAlignment="Stretch">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding ID_PRODUCTO}" Width="60"/>
                        <DataGridTextColumn Header="NOMBRE" Binding="{Binding NOMBRE_PRODUCTO}" Width="*"/>
                        <DataGridTextColumn Header="PRECIO" Binding="{Binding PRECIO, StringFormat=F2}" Width="80"/>
                        <DataGridTextColumn Header="STOCK" Binding="{Binding CANTIDAD_STOCK}" Width="60"/>
                        <DataGridTextColumn Header="DESCRIPCIÓN" Binding="{Binding DESCRIPCION}" Width="200"/>
                    </DataGrid.Columns>
                </DataGrid>
            </StackPanel>
        </Grid>

        <StackPanel Grid.Column="2" Background="#FF4A4AFF" Margin="5">
            <Label Content="Fecha :" Foreground="White" FontWeight="Bold" Margin="10"/>
            <Calendar Margin="10"
                      SelectedDate="{Binding FechaVenta}"/>

            <StackPanel Margin="0,190,0,0">
                <Label Content="Monto Total :" Foreground="White" FontWeight="Bold" Margin="10,20,10,0"/>
                <TextBlock Text="{Binding TotalVenta}" Foreground="White" FontSize="24"
                           FontWeight="Bold" HorizontalAlignment="Center" Margin="10"/>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="10,30">
                    <Button Content="Cancelar" Width="100" Margin="5" Padding="5" 
                            Command="{Binding CancelarVentaCommand}"/>
                    <Button Content="Proceder" Width="100" Margin="5" Padding="5" 
                            Command="{Binding ProcederVentaCommand}"/>
                </StackPanel>
            </StackPanel>
        </StackPanel>
    </Grid>
</Window>